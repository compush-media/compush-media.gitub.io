<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aper√ßu ‚Äì Offre du jour</title>

  <!-- üîê Protection par e-mail -->
  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);
      const email = params.get('email');
      const localEmail = localStorage.getItem('user_email');

      if (email) {
        localStorage.setItem('user_email', email);
        const cleanUrl = window.location.pathname.split('?')[0];
        window.history.replaceState({}, document.title, cleanUrl);
      }

      if (!email && !localEmail) {
        const pathParts = window.location.pathname.split('/');
        const basePath = '/' + pathParts[1] + '/';
        window.location.href = basePath + 'inscription.html';
      }
    })();
  </script>

  <style>
    :root{
      --brand:#B48C4A;
      --topbar-h:56px;
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: 'Montserrat', sans-serif;
      background: #fafafa;
    }

    /* üîù Topbar */
    .topbar{
      position: fixed;
      top: 0; left: 0; right: 0;
      height: var(--topbar-h);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 0 14px;
      z-index: 10000;
      background: transparent;
    }

    .back-btn{
      display: inline-grid;
      place-items: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(180,140,74,.16);
      border: none;
      cursor: pointer;
    }

    .back-btn::before{
      content:"";
      width: 12px;
      height: 12px;
      border-left: 3px solid var(--brand);
      border-bottom: 3px solid var(--brand);
      transform: translateX(2px) rotate(45deg);
    }

    /* üîó Bouton partage */
    .share-btn{
      background: var(--brand);
      color: #fff;
      border: none;
      border-radius: 999px;
      padding: 10px 16px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(0,0,0,.15);
    }

    iframe {
      width: 100%;
      height: 100vh;
      border: none;
      margin-top: var(--topbar-h);
      display: block;
    }
  </style>
</head>

<body>

  <!-- üîù Topbar -->
  <header class="topbar">
    <button class="back-btn" aria-label="Retour" onclick="goBackUniversal()"></button>
    <button class="share-btn" onclick="shareOffer()">üîó Partager</button>
  </header>

  <!-- üìÑ Offre du jour -->
  <iframe
    src="https://admin.fidelavis.com/resto1-offre-du-jour"
    title="Offre du jour ‚Äì Fidelavis"
    loading="lazy">
  </iframe>

  <script>
    const SHARE_URL = "https://bit.ly/4psvq0G";

    function shareOffer() {
      if (navigator.share) {
        navigator.share({
          title: "D√©couvre cette offre Fidelavis",
          text: "Une offre sympa √† d√©couvrir üëá",
          url: SHARE_URL
        });
      } else {
        navigator.clipboard.writeText(SHARE_URL);
        alert("Lien copi√© üìã\nTu peux le partager maintenant.");
      }
    }

    function goBackUniversal(){
      if (window.history.length > 1) {
        window.history.back();
      } else {
        window.location.href = "./index.html";
      }
    }
  </script>

</body>
</html>
