<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Installer lâ€™app</title>

<link rel="manifest" href="https://progressier.app/zb3Ezrlt6Ezd6iN3VpMW/progressier.json"/>
<script defer src="https://progressier.app/zb3Ezrlt6Ezd6iN3VpMW/script.js"></script>

<!-- Core commun -->
<script src="../assets/core.js"></script>

<style>
/* ton CSS conservÃ© */
:root{
  --gold:#B8924F;
  --bg:#f6efe5;
  --card:#ffffff;
  --ink:#1d1d1d;
  --muted:#6b6b6b;
  --line:rgba(0,0,0,0.08);
  --shadow:0 18px 40px rgba(0,0,0,0.12);
  --danger:#b6152b;
  --radius:22px;
}
/* ... (je garde ton CSS inchangÃ© pour raccourcir ici) */
</style>
</head>

<body>
<div class="wrap">
  <div class="badge"><span class="dot"></span>Installation requise (1 seule fois)</div>

  <h1>ğŸ“² Installer lâ€™app â€” <span data-resto-name>Restaurant</span></h1>
  <p class="sub">AprÃ¨s installation, vous accÃ©dez au coupon et vous pourrez le valider en caisse.</p>

  <div class="card">
    <p class="big">ğŸ Votre -10% sur votre prochaine <b>addition</b> est prÃªt.</p>
    <div class="note">â›” Faites-le maintenant (sinon vous risquez de perdre lâ€™accÃ¨s)</div>

    <div class="steps hidden" id="iosSteps">
      <div class="step"><div class="num">1</div><div>Appuyez sur <b>Partager</b> (icÃ´ne en bas).</div></div>
      <div class="step"><div class="num">2</div><div>Choisissez <b>Sur lâ€™Ã©cran dâ€™accueil</b> â†’ <b>Ajouter</b>.</div></div>
    </div>

    <div class="steps hidden" id="androidSteps">
      <div class="step"><div class="num">1</div><div>Appuyez sur <b>Installer maintenant</b> ci-dessous.</div></div>
      <div class="step"><div class="num">2</div><div>Validez. Lâ€™app apparaÃ®t sur votre Ã©cran dâ€™accueil âœ…</div></div>
    </div>
  </div>
</div>

<div class="sticky">
  <div class="ctaWrap">
    <button class="btn primary" id="installBtn" type="button">ğŸ“² Installer maintenant</button>
    <button class="btn secondary" id="doneBtn" type="button">âœ… Jâ€™ai installÃ©</button>

    <div class="pillRow">
      <span id="devicePill">DÃ©tectionâ€¦</span>
      <span>ğŸ”’ Aucun engagement</span>
    </div>
  </div>
</div>

<script>
function isStandalone(){
  return window.matchMedia("(display-mode: standalone)").matches ||
         window.navigator.standalone === true;
}
function isIOS(){
  return /iphone|ipad|ipod/i.test(navigator.userAgent) ||
         (navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1);
}
function isAndroid(){
  return /android/i.test(navigator.userAgent);
}

// Si dÃ©jÃ  installÃ© â†’ inscription
if (isStandalone()){
  Fidelavis.go("inscription.html");
}

const ios = isIOS();
const andr = isAndroid();

const iosSteps = document.getElementById("iosSteps");
const androidSteps = document.getElementById("androidSteps");
const devicePill = document.getElementById("devicePill");
const installBtn = document.getElementById("installBtn");

if (ios){
  devicePill.textContent = "ğŸ“± iPhone dÃ©tectÃ©";
  iosSteps.classList.remove("hidden");

  installBtn.textContent = "ğŸ“¤ Suivre les instructions";
  installBtn.addEventListener("click", () => {
    devicePill.textContent = "ğŸ‘‡ Partager â†’ Sur lâ€™Ã©cran dâ€™accueil";
  });

} else {
  devicePill.textContent = andr ? "ğŸ¤– Android dÃ©tectÃ©" : "ğŸ“± Mobile dÃ©tectÃ©";
  androidSteps.classList.remove("hidden");

  installBtn.addEventListener("click", () => {
    devicePill.textContent = "âœ… Appuyez sur Installer";
  });
}

// Bouton continuer
document.getElementById("doneBtn").addEventListener("click", () => {
  Fidelavis.go("inscription.html");
});

// Charge config.json (nom du resto + couleur)
(async function(){
  try {
    await Fidelavis.loadConfig();
  } catch(e) {
    console.warn("config non chargÃ©");
  }
})();
</script>
</body>
</html>
