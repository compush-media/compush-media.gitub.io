<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Coupon activ√©</title>

<style>
:root{
  --gold:#B8924F;
  --bg:#f6efe5;
  --card:#ffffff;
  --ink:#1d1d1d;
  --muted:#6b6b6b;
  --line:rgba(0,0,0,0.08);
  --shadow:0 18px 40px rgba(0,0,0,0.12);
  --ok:#1f8a4c;
  --danger:#b6152b;
  --radius:22px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:
    radial-gradient(1200px 600px at 50% -120px, rgba(184,146,79,0.18), transparent 60%),
    linear-gradient(180deg,#f7f0e8 0%,#f4eadf 100%);
  color:var(--ink);
  padding:24px 16px 120px;
  text-align:center;
}
.wrap{max-width:560px;margin:0 auto}
.badge{
  display:inline-flex;align-items:center;gap:10px;
  padding:10px 14px;border-radius:999px;
  background:rgba(255,255,255,.8);
  border:1px solid var(--line);
  font-weight:900;font-size:13px;
  box-shadow:0 10px 18px rgba(0,0,0,.05);
}
.dot{
  width:10px;height:10px;border-radius:50%;
  background:var(--ok);
  box-shadow:0 0 0 6px rgba(31,138,76,.15);
}
h1{ margin:18px 0 8px; font-size:28px; font-weight:950; }
.sub{ margin:0 0 20px; font-size:15px; color:var(--muted); line-height:1.5; }
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:20px 18px;
  box-shadow:var(--shadow);
  border:1px solid var(--line);
  text-align:left;
}
.step{ display:flex; gap:12px; margin:14px 0 0; font-size:14px; line-height:1.4; }
.num{
  width:28px;height:28px;border-radius:8px;
  background:rgba(184,146,79,.15);
  display:flex;align-items:center;justify-content:center;
  font-weight:900;
}
.warn{
  margin-top:16px;
  padding:10px 12px;
  border-radius:12px;
  background:rgba(182,21,43,.08);
  border:1px solid rgba(182,21,43,.2);
  color:#7a1120;
  font-size:13px;
  font-weight:900;
}
.sticky{
  position:fixed;left:0;right:0;bottom:0;
  padding:12px 16px calc(12px + env(safe-area-inset-bottom));
  background:linear-gradient(180deg,rgba(246,239,229,0) 0%,rgba(246,239,229,.95) 40%,rgba(246,239,229,1) 100%);
}
.cta{
  width:100%;
  border:none;
  border-radius:16px;
  padding:16px;
  font-size:16px;
  font-weight:900;
  background:linear-gradient(180deg,#ffffff 0%,#fbf7f1 100%);
  border:2px solid rgba(184,146,79,.45);
  box-shadow:0 14px 26px rgba(184,146,79,.25);
  cursor:pointer;
}
</style>
</head>

<body>
<div class="wrap">
  <div class="badge"><span class="dot"></span>Activation confirm√©e</div>

  <h1 id="title">‚úÖ Votre -10% est activ√©</h1>

  <p class="sub" id="subText">
    Vous recevrez votre r√©duction par email.
    Elle s‚Äôapplique sur votre prochaine <b>addition</b>.
  </p>

  <div class="card">
    <div class="step"><div class="num">1</div><div>Conservez l‚Äôapplication sur votre √©cran d‚Äôaccueil.</div></div>
    <div class="step"><div class="num">2</div><div>Lors de votre prochaine visite, ouvrez l‚Äôapp.</div></div>
    <div class="step"><div class="num">3</div><div>Pr√©sentez votre coupon en caisse pour validation.</div></div>
    <div class="warn">‚ö†Ô∏è Une capture d‚Äô√©cran ne valide pas le coupon.</div>
  </div>
</div>

<div class="sticky">
  <button class="cta" id="goCoupon" type="button">üì≤ Ouvrir mon espace fid√©lit√©</button>
</div>

<script>
function isStandalone(){
  return window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true;
}

function currentFolderBase(){
  // Ex: /resto2/merci.html -> /resto2/
  const p = location.pathname;
  return p.slice(0, p.lastIndexOf("/") + 1);
}

function saveEmailFromUrl(){
  const params = new URLSearchParams(location.search);
  const email = (params.get("email") || "").trim();

  // Si l'email est valide, on le stocke pour les pages suivantes (coupon.html, etc.)
  if (email && email.includes("@")) {
    localStorage.setItem("user_email", email);

    // Nettoie l'URL (on enl√®ve email de la barre)
    params.delete("email");
    const clean = location.pathname + (params.toString() ? "?" + params.toString() : "");
    history.replaceState({}, document.title, clean);
  }
}

function goTo(page){
  const base = currentFolderBase();
  const url = new URL(base + page, location.origin);

  // Conserve les param√®tres utiles (resto, logo...) mais JAMAIS email
  const params = new URLSearchParams(location.search);
  params.delete("email");
  params.forEach((v,k)=>url.searchParams.set(k,v));

  location.href = url.toString();
}

function getRestoName(){
  const params = new URLSearchParams(location.search);
  const fromParam = params.get("resto");
  if (fromParam) return fromParam;

  // Optionnel: d√©tecter "resto2" dans /resto2/...
  const parts = location.pathname.split("/").filter(Boolean);
  if (parts.length >= 1) return parts[0]; // "resto2"
  return null;
}

// INIT: on sauve l‚Äôemail d√®s l‚Äôarriv√©e sur merci.html
saveEmailFromUrl();

const resto = getRestoName();
if (resto){
  const nice = resto.replace(/[-_]/g," ").replace(/\b\w/g, c => c.toUpperCase());
  document.getElementById("title").innerHTML =
    "‚úÖ Votre -10% chez <span style='color:#B8924F'>" + nice + "</span> est activ√©";

  document.getElementById("subText").innerHTML =
    "Vous recevrez votre r√©duction chez <b>" + nice + "</b> par email.<br>" +
    "Elle s‚Äôapplique sur votre prochaine <b>addition</b>.";
}

document.getElementById("goCoupon").addEventListener("click", () => {
  goTo("coupon.html");
});
</script>
</body>
</html>
