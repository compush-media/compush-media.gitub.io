<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Installer l‚Äôapplication</title>

<!-- Progressier -->
<link rel="manifest" href="https://progressier.app/zb3Ezrlt6Ezd6iN3VpMW/progressier.json"/>
<script defer src="https://progressier.app/zb3Ezrlt6Ezd6iN3VpMW/script.js"></script>

<style>
:root{
  --brand:#C6A667;
  --bg:#fff8f2;
  --radius:22px;
  --shadow:0 20px 55px rgba(0,0,0,.10);
}

body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background: radial-gradient(900px 520px at 50% 0%, #ffffff 0%, var(--bg) 70%, #efe7db 100%);
  padding:28px 16px;
  color:#222;
  text-align:center;
}

.wrap{
  max-width:520px;
  margin:0 auto;
}

h1{
  font-size:22px;
  margin:0 0 10px;
}

.sub{
  font-size:13px;
  opacity:.65;
  margin-bottom:22px;
}

.card{
  background:#fff;
  border-radius:var(--radius);
  padding:20px;
  box-shadow:var(--shadow);
  margin-bottom:18px;
  text-align:left;
}

.card strong{
  color:#111;
}

ol{
  padding-left:18px;
  margin-top:8px;
  font-size:14px;
  line-height:1.45;
}

.btnrow{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  margin-top:16px;
}

.btn{
  border:none;
  border-radius:999px;
  padding:12px 16px;
  font-weight:900;
  font-size:14px;
  cursor:pointer;
  text-decoration:none;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}

.btn.primary{
  background: linear-gradient(180deg, var(--brand), #b8924f);
  color:#fff;
}

.btn.secondary{
  background:#fff;
  color:var(--brand);
  border:2px solid var(--brand);
}

.badge{
  display:inline-block;
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
  border:1px solid #ddd;
  margin-bottom:10px;
}

.badge.ok{
  border-color:#0a0;
  color:#070;
}

.muted{
  font-size:12px;
  opacity:.6;
  margin-top:16px;
}

.hidden{ display:none !important; }

</style>
</head>

<body>

<div class="wrap">

  <h1>üì≤ Installer l‚Äôapplication</h1>
  <div class="sub">
    Installation n√©cessaire pour valider le coupon en caisse.
  </div>

  <div>
    <span id="statusBadge" class="badge">D√©tection‚Ä¶</span>
  </div>

  <!-- iOS -->
  <div class="card" id="iosCard">
    <strong>Sur iPhone / iPad :</strong>
    <ol>
      <li>Ouvre ce site dans <strong>Safari</strong></li>
      <li>Appuie sur <strong>Partager</strong> (‚¨ÜÔ∏è)</li>
      <li>Choisis <strong>Ajouter √† l‚Äô√©cran d‚Äôaccueil</strong></li>
    </ol>
  </div>

  <!-- Android -->
  <div class="card">
    <strong>Sur Android / PC :</strong>
    <div id="installHint" class="muted">
      Si le bouton ‚ÄúInstaller‚Äù n‚Äôappara√Æt pas, le navigateur ne propose pas encore l‚Äôinstallation.
    </div>

    <div class="btnrow">
      <button id="installBtn" class="btn primary hidden" type="button">
        Installer maintenant
      </button>

      <a id="continueBtn" class="btn secondary" href="#">
        Continuer vers l‚Äôinscription
      </a>
    </div>
  </div>

  <div class="muted">
    Si l‚Äôapplication est d√©j√† install√©e, l‚Äôinscription s‚Äôouvrira automatiquement.
  </div>

</div>

<script>
const SIGNUP_URL = "/signup";

const els = {
  statusBadge: document.getElementById("statusBadge"),
  iosCard: document.getElementById("iosCard"),
  installBtn: document.getElementById("installBtn"),
  continueBtn: document.getElementById("continueBtn"),
  installHint: document.getElementById("installHint"),
};

function isIos(){
  const ua = navigator.userAgent || "";
  return /iPad|iPhone|iPod/.test(ua) ||
         (navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1);
}

function isStandalone(){
  return window.matchMedia?.("(display-mode: standalone)")?.matches ||
         window.navigator.standalone === true;
}

function setBadge(text, ok=false){
  els.statusBadge.textContent = text;
  els.statusBadge.classList.toggle("ok", ok);
}

function resolveGithubPagesBase(){
  const parts = location.pathname.split("/").filter(Boolean);
  if(location.hostname.endsWith("github.io") && parts.length > 0){
    return "/" + parts[0];
  }
  return "";
}

const base = resolveGithubPagesBase();
els.continueBtn.href = base + SIGNUP_URL;

if(isStandalone()){
  setBadge("Mode app d√©tect√© ‚úÖ", true);
  location.replace(base + SIGNUP_URL);
}else{
  setBadge(isIos() ? "iOS d√©tect√©" : "Navigateur d√©tect√©");
}

if(!isIos()){
  els.iosCard.classList.add("hidden");
}

let deferredPrompt = null;

window.addEventListener("beforeinstallprompt", (e)=>{
  e.preventDefault();
  deferredPrompt = e;
  els.installBtn.classList.remove("hidden");
  els.installHint.textContent = "Clique sur ‚ÄúInstaller maintenant‚Äù pour ajouter l‚Äôapp.";
  setBadge("Installation disponible ‚úÖ", true);
});

window.addEventListener("appinstalled", ()=>{
  location.href = base + SIGNUP_URL;
});

els.installBtn.addEventListener("click", async ()=>{
  if(!deferredPrompt) return;
  try{
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
  }finally{
    deferredPrompt = null;
    els.installBtn.classList.add("hidden");
  }
});
</script>

</body>
</html>
